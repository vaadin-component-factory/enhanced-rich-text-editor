{"version":3,"file":"css-hook.js","sourceRoot":"","sources":["../src/lib/css-hook.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,QAAQ,EAAC,MAAM,kBAAkB,CAAC;AAG1C;;;;;;GAMG;AACH,MAAM,CAAC,MAAM,IAAI,GAAa,KAAK,EAAE,GAAG,EAAE,OAAO,EAAE,QAAQ,EAAE,EAAE;IAC7D,IAAI,OAAO,CAAC,gBAAgB,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;QAC5C,MAAM,OAAO,GAAG,MAAM,QAAQ,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC;QACtD,MAAM,IAAI,GAAG;;;0BAGS,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;;KAE5C,CAAC;QACF,OAAO,EAAC,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAC,CAAC;IAC9D,CAAC;SAAM,IAAI,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;QAClD,IAAI,CAAC;YACH,OAAO,MAAM,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QACtC,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,CAAC,IAAI,CACV,mBAAmB,GAAG,+BAA+B;gBACnD,8FAA8F,CACjG,CAAC;YACF,MAAM,CAAC,CAAC;QACV,CAAC;IACH,CAAC;IACD,OAAO,MAAM,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;AACtC,CAAC,CAAC","sourcesContent":["import {readFile} from 'node:fs/promises';\nimport type {LoadHook} from 'node:module';\n\n/**\n * When an attempt is made to import a CSS file/module, code is\n * generated to read the corresponding file, add it to a CSSStyleSheet\n * instance and return that instance as the default export.\n *\n * https://nodejs.org/api/module.html#loadurl-context-nextload\n */\nexport const load: LoadHook = async (url, context, nextLoad) => {\n  if (context.importAttributes.type === 'css') {\n    const content = await readFile(new URL(url), 'utf-8');\n    const code = `\n      import {CSSStyleSheet} from '@lit-labs/ssr-dom-shim';\n      const sheet = new CSSStyleSheet();\n      sheet.replaceSync(${JSON.stringify(content)});\n      export default sheet;\n    `;\n    return {format: 'module', shortCircuit: true, source: code};\n  } else if (new URL(url).pathname.endsWith('.css')) {\n    try {\n      return await nextLoad(url, context);\n    } catch (e) {\n      console.warn(\n        `Tried to import ${url} without import attributes!\\n` +\n          `(e.g. use \"import s from './a.css' with {type: 'css'}\" instead of \"import s from './a.css'\")`\n      );\n      throw e;\n    }\n  }\n  return await nextLoad(url, context);\n};\n"]}