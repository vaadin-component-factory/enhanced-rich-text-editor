# Phase 4.3: Tables UI Controls & Java API

**Status:** NOT STARTED

## Objective

Implement table UI controls (add/delete row/column buttons) and Java API for table configuration and manipulation.

## Scope

### UI Controls

1. **Column Controls**
   - Add column left
   - Add column right
   - Delete column

2. **Row Controls**
   - Add row above
   - Add row below
   - Delete row

3. **Table Controls**
   - Insert table (toolbar button or dialog)
   - Delete table
   - Table properties (borders, etc.)

4. **Cell Controls**
   - Merge cells
   - Split cells
   - Cell properties

5. **Visual Feedback**
   - Hover indicators
   - Selected cell highlighting
   - Control positioning
   - Icons (Lumo integration)

### Java API

1. **Configuration Classes**
   - `TableConfiguration` — table-level settings
   - `CellConfiguration` — cell-level settings
   - **Template support** (V24 has "style template functionality" — predefine/modify/apply visual styles)
     - ⚠️ **SECURITY IMPLICATION:** Templates define benutzerdefinierte CSS classes & styles
     - See Phase 3.6: Template-basierte Validierung erforderlich (NICHT statische Whitelist)

2. **Component API**
   - `insertTable(rows, cols)`
   - `deleteTable(tableId)`
   - `setTableConfiguration(TableConfiguration)`
   - **Template API:**
     - `setTableTemplates(List<TableTemplate>)` — define available templates
     - `applyTemplate(tableId, templateId)` — apply template to table
     - Template validation against allowed CSS properties/classes
   - Event listeners (table created, deleted, modified, **template changed**)

3. **Metadata API**
   - Access cell metadata
   - Query table structure
   - Programmatic table manipulation

4. **Integration with ERTE Core**
   - **Sanitizer whitelist** (table elements)
     - ⚠️ **CRITICAL:** Template-based classes/styles müssen erlaubt werden
     - **Approach 1:** Dynamic whitelist based on defined templates
     - **Approach 2:** Pattern-based whitelist (`table-template-*`) + post-validation
     - See SECURITY.md: "CSS Injection in Table Colors" (validate color values)
     - See SECURITY.md: "TemplateParser CSS Values Not Validated" (re-enable validation)
   - Delta value format
   - HTML serialization

## Success Criteria

- [ ] All UI controls functional
- [ ] Java API matches V24 capabilities
- [ ] Visual feedback for user actions
- [ ] Keyboard navigation works
- [ ] Events fire correctly
- [ ] Integrates cleanly with ERTE Core
- [ ] Reviewed by fullstack-developer + ui-designer agents

## Technical Challenges

**Control Positioning:**
- Absolute positioning relative to table
- Shadow DOM boundary crossing
- Scroll handling
- Responsive behavior

**Cell Metadata Encoding:**
- Encode/decode in Delta ops
- Preserve through sanitizer
- Survive copy-paste

**Merge/Split Cells:**
- Rowspan/colspan management
- Content redistribution
- Delta format representation

## Resources

- V24 table UI code
- Vaadin Tables addon (if exists)
- Test views for usage patterns
- UI-designer agent for control placement

## Output

- `frontend/table-controls.js` — UI controls
- `TableConfiguration.java` — configuration API
- Java API methods in `EnhancedRichTextEditorTables.java`
- Event classes
- CSS for controls (in `static get styles()`)
