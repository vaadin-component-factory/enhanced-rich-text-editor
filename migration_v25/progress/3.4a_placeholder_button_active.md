# Phase 3.4a: Placeholder Button Active State Fix

## Status: NOT STARTED

## Description

Fix the placeholder toolbar button to correctly show "active" state when the cursor is positioned beside a placeholder in the editor (via mouse or keyboard navigation).

## Problem

Currently the placeholder button stays "inactive" even when the cursor is adjacent to a placeholder. The event log shows `PlaceholderLeave` firing immediately, even when the cursor is still positioned at the placeholder.

## Root Cause Hypothesis

Quill 2's guard elements (zero-width text nodes `\uFEFF` inside the embed) likely interfere with the "beside placeholder" detection. The cursor might technically be inside a guard node rather than "at" the embed index from Quill's perspective.

## Expected Behavior

The placeholder button should be marked as "active" (matching RTE 2's toolbar button active state styling) when:
- Cursor is placed immediately before the placeholder (index = embed index)
- Cursor is placed immediately after the placeholder (index = embed index + 1)
- User clicks on the placeholder (triggering placeholder dialog)

The button should return to "inactive" state when the cursor moves to a position that is not adjacent to any placeholder.

## Implementation Notes

- Check `_onSelectionChange()` logic for placeholder detection
- May need to use `Quill.getLeaf()` or `Quill.getLine()` to accurately detect adjacent embeds despite guard nodes
- Consider comparing with RTE 2's link button active state detection as reference
- Event sequence: selection-change → check bounds → update button state

## Acceptance Criteria

- [ ] Placeholder button shows active state when cursor is before placeholder
- [ ] Placeholder button shows active state when cursor is after placeholder
- [ ] Placeholder button shows active state when placeholder is clicked
- [ ] Button returns to inactive when cursor moves away
- [ ] No console errors
- [ ] Behavior matches stock RTE 2's link button active state pattern

## Test Impact

No new tests needed — existing placeholder tests should pass. May need to add explicit test for button active state if not already covered.
