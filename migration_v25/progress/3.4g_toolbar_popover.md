# Phase 3.4g: ToolbarPopover

**Status:** NOT STARTED
**Type:** Feature Migration
**Priority:** MEDIUM — Helper class for custom toolbar extensions
**Created:** 2026-02-21

---

## Scope

Migrate `ToolbarPopover` class from V24 to V25. This is a convenience wrapper around Vaadin's `Popover` component that integrates with `ToolbarSwitch` for opening/closing.

---

## Background

### V24 Implementation

Location: `enhanced-rich-text-editor/src/main/java/com/vaadin/componentfactory/toolbar/ToolbarPopover.java`

**Key Features:**
- Wraps Vaadin 24's `Popover` component
- Opens/closes based on `ToolbarSwitch` active state
- Provides static factory methods: `vertical()` and `horizontal()`
- Automatic focus management (`setFocusOnOpenTarget()`)
- Auto-attaches to switch parent, auto-detaches on switch detach
- Sets `restoreFocusOnClose` property

**API:**
```java
// Factory methods
static ToolbarPopover vertical(ToolbarSwitch toolbarSwitch, Component... components)
static ToolbarPopover horizontal(ToolbarSwitch toolbarSwitch, Component... components)
static ToolbarPopover horizontal(ToolbarSwitch toolbarSwitch, Alignment alignment, Component... components)

// Constructor
ToolbarPopover(ToolbarSwitch referencedSwitch)

// Methods
void setFocusOnOpenTarget(Component focusOnOpenTarget)
```

### V25 Changes

**Vaadin 25 Popover API:**
- Check if `Popover` API changed between V24 and V25
- Verify `restoreFocusOnClose` property still exists
- Confirm `setAutofocus()`, `setTarget()`, `addOpenedChangeListener()` unchanged

---

## Tasks

### 1. Create ToolbarPopover.java (V25)

Location: `enhanced-rich-text-editor-v25/src/main/java/com/vaadin/componentfactory/toolbar/ToolbarPopover.java`

- [ ] Copy V24 implementation as starting point
- [ ] Update license header (2025)
- [ ] Verify Vaadin 25 imports work (`com.vaadin.flow.component.popover.Popover`)
- [ ] Test if `restoreFocusOnClose` property still needs manual setting or is fixed in V25

### 2. Add JavaDoc

- [ ] Class-level JavaDoc explaining purpose
- [ ] Document integration with ToolbarSwitch
- [ ] Document factory methods and alignment options

### 3. Create Test View (Optional)

Only if not already covered by existing demos:

- [ ] Add test view showing popover with toolbar switch
- [ ] Test vertical and horizontal layouts
- [ ] Test focus management

### 4. Update Documentation

- [ ] Add to API documentation
- [ ] Add example usage in developer docs
- [ ] Mention in UPGRADE_GUIDE.md if API changed

---

## Testing Strategy

- **Manual:** Create simple demo with ToolbarSwitch + ToolbarPopover, verify open/close behavior
- **Unit:** Consider unit tests for focus management and listener registration
- **Integration:** Verify with actual ERTE instance in demo app

---

## Dependencies

- ✅ Phase 3.1a (Toolbar Slot System) — provides `ToolbarSwitch`
- ⚠️ Phase 3.4f (Slotted Styles) — may be needed for proper button appearance

---

## Definition of Done

- [ ] `ToolbarPopover.java` created with V25-compatible implementation
- [ ] JavaDoc complete
- [ ] Manual testing shows open/close works correctly
- [ ] Focus management works as expected
- [ ] Progress file updated to COMPLETE
- [ ] Commit created: "Add ToolbarPopover helper class (Phase 3.4g)"
