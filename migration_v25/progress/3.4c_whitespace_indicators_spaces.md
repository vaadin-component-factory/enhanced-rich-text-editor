# Phase 3.4c: Whitespace Indicators for Spaces and NBSP

## Status: NOT STARTED

## Description

Extend the whitespace indicators feature (Phase 3.3b) to show indicators for regular spaces and non-breaking spaces (NBSP). Currently, indicators only show for tabs and paragraph marks.

## Problem

Phase 3.3b implemented whitespace indicators but did not include:
- Regular spaces (U+0020)
- Non-breaking spaces (U+00A0, inserted via Shift+Space in Phase 3.3a)

Both should display a middle dot `·` (U+00B7) when whitespace indicators are enabled.

## Design

- **Visual**: Middle dot `·` in light gray (matching tab/paragraph indicator style)
- **Toggle**: Controlled by existing `whitespaceIndicatorsVisible` property
- **CSS**: Add to existing `.ql-show-whitespace` ruleset in `vcf-enhanced-rich-text-editor.js`
- **NBSP**: Target the `<span class="ql-nbsp">` embed (Phase 3.3a)
- **Spaces**: Use CSS `::before` pseudo-element on text nodes (tricky — may need different approach)

## Implementation Challenges

### Regular Spaces
Text nodes don't support `::before`/`::after` pseudo-elements in CSS. Options:
1. **Inline indicator spans**: Wrap each space in `<span class="space-indicator"> </span>` via Quill format
2. **Font substitution**: Use a custom font with visible space glyphs (not recommended — accessibility issues)
3. **Background-based**: Use `background-image` with repeated dots (limited control)
4. **JavaScript injection**: Traverse text nodes and inject indicator elements (fragile, performance concern)

**Recommended**: Option 1 (inline spans) via custom Inline blot or format, similar to readonly formatting.

### NBSP Embed
NBSP is already wrapped in `<span class="ql-nbsp">` — add `::before` indicator in CSS when `.ql-show-whitespace` is active. **This is straightforward.**

## Implementation Approach

1. **NBSP first** (easy win):
   - Add CSS rule: `.ql-show-whitespace .ql-nbsp::before { content: '·'; color: ...; }`
   - Test with existing NBSP tests

2. **Regular spaces** (complex):
   - Evaluate options 1–4 above
   - If using inline spans: create `SpaceIndicatorBlot` or `space` format
   - Apply format when whitespace indicators toggle on
   - Remove format when toggle off
   - Consider performance impact (many spaces in large documents)

3. **Alternative**: Skip regular spaces if implementation is too fragile/complex. Focus on NBSP only as a pragmatic compromise.

## Acceptance Criteria

- [ ] NBSP shows middle dot `·` when whitespace indicators enabled
- [ ] Regular spaces show middle dot `·` when whitespace indicators enabled (if feasible)
- [ ] Indicators disappear when whitespace indicators disabled
- [ ] No performance degradation on large documents
- [ ] No visual artifacts or layout shifts
- [ ] Indicators match existing tab/paragraph style (light gray, middle dot)
- [ ] Tests pass (update `features.spec.ts` whitespace tests)

## Test Impact

Extend existing whitespace indicator tests in `features.spec.ts` to verify:
- NBSP indicator appears/disappears with toggle
- Space indicator appears/disappears with toggle (if implemented)
- No side effects on formatting or editing

## Cross-Cutting Notes

If regular space indicators prove too complex or fragile, document the limitation and consider it a "nice-to-have" deferred to a future version. NBSP indicators alone provide significant value.
