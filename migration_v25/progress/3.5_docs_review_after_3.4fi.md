# Documentation Review: Phases 3.4f-i Impact Analysis

**Date:** 2026-02-21
**Updated:** 2026-02-22
**Reviewer:** Documentation Engineer Agent
**Scope:** Review existing ERTE v6.x user documentation against planned phases 3.4f-i (not yet implemented)

> **Update (2026-02-22):** Phase 3.4j (Aura Theme Support) has been moved to Phase 5.1 (post-6.0.0 release). ERTE 6.0.0 will focus on Lumo theme support only. All 3.4j-related documentation gaps (Gaps 9-13) are now deferred to Phase 5 documentation updates.

---

## Executive Summary

The current documentation (UPGRADE_GUIDE.md, USER_GUIDE.md, API_REFERENCE.md, CONFIGURATION.md) was written after Phase 3.3f (Align Justify) and before phases 3.4f-j. Once these five phases are implemented, **13 documentation sections will require updates**, with **3 critical gaps** (missing APIs, misleading statements) and **10 important gaps** (incomplete feature coverage).

**Recommendation:** Update documentation after each phase is implemented rather than waiting for all 5 phases to complete. This prevents drift and ensures documentation stays in sync with code.

---

## Phase-by-Phase Gap Analysis

### Phase 3.4f: Slotted Toolbar Button Styles

**What it does:** Adds `::slotted()` CSS rules to the web component so custom buttons added via `addToolbarComponents()` get proper toolbar styling (height, padding, icon sizing matching native buttons).

**Current state:** Custom toolbar buttons currently lack proper styling. Users must manually style them or accept inconsistent appearance.

#### Gap 1: USER_GUIDE.md -- Section 2.1 "Toolbar Customization"

**Impact:** Important (feature gap, not misleading)
**Location:** Lines 123-182 (toolbar customization)
**Issue:** The guide shows adding custom buttons but doesn't mention styling considerations.

**Required change:**
- Add subsection "1.5 Custom Button Styling" after line 164 (after "Replacing Button Icons")
- Document that custom buttons added to toolbar slots automatically receive toolbar styles
- Show example of what styles are applied (height, padding, icon sizing)
- Show how to override these styles if needed

**Example content:**
```markdown
### 1.5 Custom Button Styling

Buttons and components added to toolbar slots automatically receive toolbar styling:
- Height matches native toolbar buttons
- Padding and spacing align with toolbar layout
- Icon sizing (if using `Button(Icon)`) matches native button icons

**Example: styled custom button**
```java
Button customBtn = new Button("Save", new Icon(VaadinIcon.DOWNLOAD));
customBtn.setId("save-btn");
editor.addToolbarComponents(ToolbarSlot.END, customBtn);
// Button automatically gets toolbar styling
```

To override default toolbar styles:
```css
#save-btn {
    height: 48px;  /* custom height */
    padding: 12px; /* custom padding */
}
```
```

---

#### Gap 2: CONFIGURATION.md -- Section 4.4 "Custom Content Styling"

**Impact:** Important (incomplete coverage)
**Location:** Lines 365-389
**Issue:** Shows how to style ERTE content but not custom toolbar buttons.

**Required change:**
- Add subsection "4.5 Custom Toolbar Button Styling" after line 389
- Document default ::slotted() styles applied by the component
- Show how to override these styles for specific slotted buttons

**Example content:**
```markdown
### 4.5 Custom Toolbar Button Styling

Custom buttons added via `addToolbarComponents()` receive default toolbar styles via `::slotted()` CSS rules:

```css
/* Applied automatically by the component */
::slotted(vaadin-button) {
    height: 32px;
    padding: 0 8px;
    font-size: var(--lumo-font-size-s);
}

::slotted(vaadin-button vaadin-icon) {
    width: 16px;
    height: 16px;
}
```

**Override slotted styles:**
```css
vcf-enhanced-rich-text-editor #my-custom-button {
    height: 40px;
    background: var(--lumo-primary-color);
}
```
```

---

### Phase 3.4g: ToolbarPopover

**What it does:** Exposes `ToolbarPopover` as a public Java API -- a helper class for creating toolbar dropdown panels (like color picker, link dialog). Currently used internally but not documented.

**Current state:** Not mentioned in any documentation. Users building custom toolbar dropdowns must implement from scratch.

#### Gap 3: USER_GUIDE.md -- Section 2.1 "Toolbar Customization"

**Impact:** Critical (missing API)
**Location:** After line 182 (after "Replacing Button Icons")
**Issue:** ToolbarPopover API is not documented. Users don't know it exists.

**Required change:**
- Add subsection "2.1.5 Toolbar Popovers" after "Replacing Button Icons"
- Document ToolbarPopover class, constructor, methods
- Show example of creating a custom dropdown (e.g., font picker, style preset picker)

**Example content:**
```markdown
### 2.1.5 Toolbar Popovers

`ToolbarPopover` is a helper class for creating dropdown panels attached to toolbar buttons.

**Example: Custom color palette popover**
```java
Button colorBtn = new Button("Palette");
ToolbarPopover popover = new ToolbarPopover(colorBtn);

VerticalLayout content = new VerticalLayout();
content.add(new Button("Red", e -> applyColor("red")));
content.add(new Button("Blue", e -> applyColor("blue")));
content.add(new Button("Green", e -> applyColor("green")));

popover.setContent(content);
editor.addToolbarComponents(ToolbarSlot.AFTER_GROUP_STYLE, colorBtn);
```

**Methods:**
- `ToolbarPopover(Button trigger)` -- Creates a popover attached to the button
- `setContent(Component content)` -- Sets the dropdown content
- `open()` / `close()` -- Programmatic control
- `isOpen()` -- Check open state
```

---

#### Gap 4: API_REFERENCE.md -- Missing ToolbarPopover Section

**Impact:** Critical (missing API)
**Location:** After Section 6 "ToolbarSwitch" (line 686)
**Issue:** ToolbarPopover class is not documented in API reference.

**Required change:**
- Add new section "7. ToolbarPopover" after ToolbarSwitch section
- Document package, class signature, constructors, methods

**Example content:**
```markdown
## 7. ToolbarPopover

```java
package com.vaadin.componentfactory.toolbar;

public class ToolbarPopover
```

A helper class for creating dropdown panels attached to toolbar buttons.

### Constructor

```java
public ToolbarPopover(Button trigger)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `trigger` | `Button` | The toolbar button that opens the popover |

### Methods

| Method | Returns | Description |
|--------|---------|-------------|
| `setContent(Component)` | `void` | Sets the popover content |
| `getContent()` | `Component` | Returns the current content |
| `open()` | `void` | Opens the popover |
| `close()` | `void` | Closes the popover |
| `isOpen()` | `boolean` | Returns open state |
| `addOpenedChangeListener(ComponentEventListener<OpenedChangeEvent>)` | `Registration` | Listens for open/close events |
```

---

### Phase 3.4h: ToolbarSelectPopup

**What it does:** Exposes `ToolbarSelectPopup` as a public Java API -- a helper class for creating select-style toolbar dropdowns (like heading selector, alignment selector). Currently internal.

**Current state:** Not mentioned in any documentation.

#### Gap 5: USER_GUIDE.md -- Section 2.1 "Toolbar Customization"

**Impact:** Critical (missing API)
**Location:** After "Toolbar Popovers" subsection (new subsection added in Gap 3)
**Issue:** ToolbarSelectPopup API is not documented.

**Required change:**
- Add subsection "2.1.6 Toolbar Select Popups" after "Toolbar Popovers"
- Document ToolbarSelectPopup class
- Show example of creating a custom select-style dropdown (e.g., font size selector, paragraph style selector)

**Example content:**
```markdown
### 2.1.6 Toolbar Select Popups

`ToolbarSelectPopup` is a helper class for creating select-style dropdowns (list of options with checkmarks for active state).

**Example: Font size selector**
```java
Button fontSizeBtn = new Button("Size");
ToolbarSelectPopup popup = new ToolbarSelectPopup(fontSizeBtn);

popup.setItems(List.of("Small", "Medium", "Large"));
popup.addItemSelectListener(event -> {
    String selected = event.getItem();
    applyFontSize(selected);
});

editor.addToolbarComponents(ToolbarSlot.AFTER_GROUP_HEADING, fontSizeBtn);
```

**Methods:**
- `ToolbarSelectPopup(Button trigger)` -- Creates a select popup
- `setItems(List<String> items)` -- Sets the options
- `setSelectedItem(String item)` -- Marks an item as selected
- `addItemSelectListener(...)` -- Listens for item selection
```

---

#### Gap 6: API_REFERENCE.md -- Missing ToolbarSelectPopup Section

**Impact:** Critical (missing API)
**Location:** After Section 7 "ToolbarPopover" (new section added in Gap 4)
**Issue:** ToolbarSelectPopup class is not documented.

**Required change:**
- Add new section "8. ToolbarSelectPopup" after ToolbarPopover section
- Document package, class signature, constructors, methods

**Example content:**
```markdown
## 8. ToolbarSelectPopup

```java
package com.vaadin.componentfactory.toolbar;

public class ToolbarSelectPopup
```

A helper class for creating select-style dropdowns with checkmarks.

### Constructor

```java
public ToolbarSelectPopup(Button trigger)
```

### Methods

| Method | Returns | Description |
|--------|---------|-------------|
| `setItems(List<String>)` | `void` | Sets the list of options |
| `getItems()` | `List<String>` | Returns current items |
| `setSelectedItem(String)` | `void` | Marks an item as selected |
| `getSelectedItem()` | `String` | Returns currently selected item |
| `addItemSelectListener(ComponentEventListener<ItemSelectEvent>)` | `Registration` | Listens for item selection |
```

---

### Phase 3.4i: ToolbarDialog

**What it does:** Exposes `ToolbarDialog` as a public Java API -- a helper class for creating modal dialogs triggered by toolbar buttons (like placeholder dialog, image upload dialog). Currently internal.

**Current state:** Not mentioned in any documentation.

#### Gap 7: USER_GUIDE.md -- Section 2.1 "Toolbar Customization"

**Impact:** Critical (missing API)
**Location:** After "Toolbar Select Popups" subsection (new subsection added in Gap 5)
**Issue:** ToolbarDialog API is not documented.

**Required change:**
- Add subsection "2.1.7 Toolbar Dialogs" after "Toolbar Select Popups"
- Document ToolbarDialog class
- Show example of creating a custom dialog (e.g., custom image upload, custom link editor)

**Example content:**
```markdown
### 2.1.7 Toolbar Dialogs

`ToolbarDialog` is a helper class for creating modal dialogs triggered by toolbar buttons.

**Example: Custom snippet dialog**
```java
Button snippetBtn = new Button("Snippet");
ToolbarDialog dialog = new ToolbarDialog("Insert Snippet", snippetBtn);

TextArea snippetArea = new TextArea("Paste snippet");
dialog.setContent(snippetArea);

dialog.addConfirmListener(event -> {
    String snippet = snippetArea.getValue();
    editor.addText(snippet);
});

editor.addToolbarComponents(ToolbarSlot.AFTER_GROUP_RICH_TEXT, snippetBtn);
```

**Methods:**
- `ToolbarDialog(String title, Button trigger)` -- Creates a dialog
- `setContent(Component content)` -- Sets dialog content
- `addConfirmListener(...)` -- Listens for confirm button
- `addCancelListener(...)` -- Listens for cancel button
- `open()` / `close()` -- Programmatic control
```

---

#### Gap 8: API_REFERENCE.md -- Missing ToolbarDialog Section

**Impact:** Critical (missing API)
**Location:** After Section 8 "ToolbarSelectPopup" (new section added in Gap 6)
**Issue:** ToolbarDialog class is not documented.

**Required change:**
- Add new section "9. ToolbarDialog" after ToolbarSelectPopup section
- Document package, class signature, constructors, methods

**Example content:**
```markdown
## 9. ToolbarDialog

```java
package com.vaadin.componentfactory.toolbar;

public class ToolbarDialog
```

A helper class for creating modal dialogs triggered by toolbar buttons.

### Constructor

```java
public ToolbarDialog(String title, Button trigger)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `title` | `String` | Dialog title |
| `trigger` | `Button` | The toolbar button that opens the dialog |

### Methods

| Method | Returns | Description |
|--------|---------|-------------|
| `setContent(Component)` | `void` | Sets the dialog content |
| `getContent()` | `Component` | Returns the current content |
| `setConfirmText(String)` | `void` | Sets confirm button label |
| `setCancelText(String)` | `void` | Sets cancel button label |
| `addConfirmListener(ComponentEventListener<ConfirmEvent>)` | `Registration` | Listens for confirm button |
| `addCancelListener(ComponentEventListener<CancelEvent>)` | `Registration` | Listens for cancel button |
| `open()` | `void` | Opens the dialog |
| `close()` | `void` | Closes the dialog |
| `isOpen()` | `boolean` | Returns open state |
```

---

### Phase 3.4j: Aura Theme Support

**What it does:** Adds support for Vaadin's alternative Aura theme (currently ERTE only supports Lumo). Includes theme-specific CSS, proper icon rendering under Aura, and configuration instructions.

**Current state:** Documentation assumes Lumo-only usage. Multiple misleading statements exist.

#### Gap 9: UPGRADE_GUIDE.md -- Section 2.5 "Lumo Theme Configuration"

**Impact:** Important (misleading after Aura support added)
**Location:** Lines 144-160
**Issue:** States "Vaadin 25 requires explicit Lumo stylesheet loading" without mentioning Aura alternative.

**Required change:**
- Rename section to "2.5 Theme Configuration"
- Add note that ERTE supports both Lumo and Aura themes
- Show configuration for both themes

**Example change:**
```markdown
### 2.5 Theme Configuration

ERTE v6.x supports both Lumo (default) and Aura themes. Vaadin 25 requires explicit theme loading.

**Lumo theme (default):**
```java
import com.vaadin.flow.component.page.AppShellConfigurator;
import com.vaadin.flow.theme.lumo.Lumo;

@StyleSheet(Lumo.STYLESHEET)
public class Application implements AppShellConfigurator {
    // ...
}
```

**Aura theme (alternative):**
```java
import com.vaadin.flow.component.page.AppShellConfigurator;
import com.vaadin.flow.theme.aura.Aura;

@StyleSheet(Aura.STYLESHEET)
public class Application implements AppShellConfigurator {
    // ...
}
```

> **Note:** Without theme configuration, toolbar icons will render as raw SVG mask images instead of the theme's icon font.
```

---

#### Gap 10: USER_GUIDE.md -- Section 1.1 "Installation"

**Impact:** Important (incomplete theme guidance)
**Location:** Lines 34-46
**Issue:** No mention of theme requirements or Aura alternative.

**Required change:**
- Add note about theme requirement after line 46
- Link to theme configuration in a separate guide or UPGRADE_GUIDE

**Example change:**
```markdown
> **Note:** Vaadin 25 moved the Rich Text Editor to the commercial `vaadin` artifact (not `vaadin-core`). A Vaadin Pro subscription or higher is required for production use.

> **Theme requirement:** ERTE requires explicit theme loading (Lumo or Aura). See [Upgrade Guide Section 2.5](UPGRADE_GUIDE.md#25-theme-configuration) for configuration instructions.
```

---

#### Gap 11: CONFIGURATION.md -- Section 4.1 "Vaadin Lumo Theme"

**Impact:** Important (misleading title)
**Location:** Lines 305-316
**Issue:** Section title implies Lumo-only support. No mention of Aura.

**Required change:**
- Rename section to "4.1 Vaadin Themes (Lumo and Aura)"
- Add subsection for each theme with theme-specific custom properties
- Document differences in toolbar button styling between themes

**Example change:**
```markdown
### 4.1 Vaadin Themes (Lumo and Aura)

ERTE supports both Lumo (default) and Aura themes.

#### 4.1.1 Lumo Theme

Lumo custom properties:

| Property | Used For |
|----------|----------|
| `--lumo-primary-color` | Toolbar button active/selected state |
| `--lumo-primary-text-color` | Toolbar button hover state |
| `--lumo-contrast-10pct` | Toolbar button borders |
| `--lumo-font-size-xs` | Small text elements |
| `--lumo-space-s` | Spacing |

#### 4.1.2 Aura Theme

Aura custom properties:

| Property | Used For |
|----------|----------|
| `--aura-primary-color` | Toolbar button active/selected state |
| `--aura-button-background` | Toolbar button background |
| `--aura-border-radius` | Toolbar button corners |

**Theme switching:**
Both themes can be loaded via `@StyleSheet` annotation (see UPGRADE_GUIDE.md Section 2.5).
```

---

#### Gap 12: CONFIGURATION.md -- Section 4.2 "Shadow Parts"

**Impact:** Important (incomplete coverage)
**Location:** Lines 318-344
**Issue:** CSS examples use Lumo custom properties. No mention of theme-specific differences.

**Required change:**
- Add note at the beginning of section 4.2 that examples use Lumo properties
- Show how to use Aura properties for theme-agnostic styling

**Example change:**
```markdown
### 4.2 Shadow Parts

> **Note:** The examples below use Lumo custom properties. Replace with Aura properties (e.g., `--aura-primary-color`) when using the Aura theme, or use theme-agnostic approaches (generic CSS values).

**Individual buttons:**
```css
vcf-enhanced-rich-text-editor::part(toolbar-button-bold) {
    color: red;
}
```
```

---

#### Gap 13: USER_GUIDE.md -- Section 5.2 "Known Limitations"

**Impact:** Important (incomplete limitation list)
**Location:** Lines 851-860
**Issue:** No mention of theme-related limitations (if any exist after 3.4j implementation).

**Required change:**
- After Phase 3.4j implementation, verify if any theme-specific limitations exist
- If yes: add entry to limitation table
- If no: no change needed

**Example (if limitation exists):**
```markdown
| Issue | Description | Workaround |
|-------|-------------|------------|
| Aura toolbar icons | Custom toolbar buttons may show Lumo icons under Aura theme | Use explicit icon classes |
```

---

## Impact Summary Table

| Doc File | Section | Phase | Impact | Change Type |
|----------|---------|-------|--------|-------------|
| USER_GUIDE.md | 2.1 Toolbar Customization | 3.4f | Important | Add subsection (Custom Button Styling) |
| USER_GUIDE.md | 2.1 Toolbar Customization | 3.4g | Critical | Add subsection (Toolbar Popovers) |
| USER_GUIDE.md | 2.1 Toolbar Customization | 3.4h | Critical | Add subsection (Toolbar Select Popups) |
| USER_GUIDE.md | 2.1 Toolbar Customization | 3.4i | Critical | Add subsection (Toolbar Dialogs) |
| USER_GUIDE.md | 1.1 Installation | 3.4j | Important | Add theme requirement note |
| USER_GUIDE.md | 5.2 Known Limitations | 3.4j | Important | Add theme-related limitations (if any) |
| CONFIGURATION.md | 4.4 Custom Content Styling | 3.4f | Important | Add subsection (Custom Toolbar Button Styling) |
| CONFIGURATION.md | 4.1 Vaadin Lumo Theme | 3.4j | Important | Rename and expand (Lumo + Aura) |
| CONFIGURATION.md | 4.2 Shadow Parts | 3.4j | Important | Add theme-agnostic styling notes |
| API_REFERENCE.md | After Section 6 | 3.4g | Critical | Add section 7 (ToolbarPopover) |
| API_REFERENCE.md | After Section 7 | 3.4h | Critical | Add section 8 (ToolbarSelectPopup) |
| API_REFERENCE.md | After Section 8 | 3.4i | Critical | Add section 9 (ToolbarDialog) |
| UPGRADE_GUIDE.md | 2.5 Lumo Theme Config | 3.4j | Important | Rename and expand (Lumo + Aura) |

---

## Prioritized Recommendations

### Critical (Must Fix Before GA)

1. **API_REFERENCE.md additions (Gaps 4, 6, 8)** -- Three new public classes (ToolbarPopover, ToolbarSelectPopup, ToolbarDialog) are completely undocumented. Users won't know these APIs exist.

2. **USER_GUIDE.md toolbar sections (Gaps 3, 5, 7)** -- Same three classes need usage examples and guidance. Without these, users building custom toolbar dropdowns will reinvent the wheel.

### Important (Should Fix Before GA)

3. **Theme documentation (Gaps 9, 11, 12)** -- Multiple sections incorrectly imply Lumo-only support. After 3.4j, this becomes misleading. Aura users will struggle.

4. **Slotted button styling (Gaps 1, 2)** -- After 3.4f, custom buttons will automatically get toolbar styles, but docs don't explain this. Users may add redundant CSS.

5. **Theme requirement note (Gap 10)** -- Installation section should mention theme requirement upfront, not buried in upgrade guide.

### Nice-to-Have

6. **Known limitations review (Gap 13)** -- Verify if 3.4j introduces any theme-related limitations. Add to known limitations section if needed.

---

## Implementation Strategy

**Sequential approach (recommended):**

1. **After Phase 3.4f:** Update Gaps 1, 2 (slotted button styling)
2. **After Phase 3.4g:** Update Gaps 3, 4 (ToolbarPopover)
3. **After Phase 3.4h:** Update Gaps 5, 6 (ToolbarSelectPopup)
4. **After Phase 3.4i:** Update Gaps 7, 8 (ToolbarDialog)
5. **After Phase 3.4j:** Update Gaps 9, 10, 11, 12, 13 (Aura theme)

**Batch approach (alternative):**

Wait until all 5 phases are complete, then update all 13 gaps at once. Faster but riskier (documentation drift during development).

---

## Files Not Requiring Changes

**These documentation files have NO gaps related to phases 3.4f-j:**

None. All four user-facing documentation files require updates.

**Reasoning:**

- **UPGRADE_GUIDE.md:** Requires theme section update (Gap 9)
- **USER_GUIDE.md:** Requires 6 updates (Gaps 1, 3, 5, 7, 10, 13)
- **API_REFERENCE.md:** Requires 3 new sections (Gaps 4, 6, 8)
- **CONFIGURATION.md:** Requires 3 updates (Gaps 2, 11, 12)

---

## Notes

- **ToolbarPopover/SelectPopup/Dialog implementation details unknown:** This review assumes standard patterns (constructor, setContent, listeners). Actual API signatures may differ -- update examples accordingly.

- **Aura theme support details unknown:** This review assumes Aura requires similar `@StyleSheet` annotation to Lumo. If implementation differs (e.g., theme variant, runtime switching), update Gap 9-13 guidance.

- **Slotted button styles unknown:** This review assumes basic height/padding/icon sizing. If implementation includes additional styles (colors, borders, hover effects), expand Gaps 1-2 documentation.

- **Theme-specific limitations unknown:** Gap 13 assumes no Aura limitations. If testing reveals issues (icon rendering, custom property conflicts, etc.), add to known limitations.

---

**Review complete. 13 gaps identified across 4 documentation files. Recommend sequential updates after each phase implementation.**
