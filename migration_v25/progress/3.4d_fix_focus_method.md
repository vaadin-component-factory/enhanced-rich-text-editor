# Phase 3.4d: Fix focus() Method

## Status: COMPLETE

## Issue Summary

The `focus()` method on `EnhancedRichTextEditor` does not reliably give focus to the editor.

**Failing test:** `tests/erte/features.spec.ts:716` - "focus() method gives focus to the editor"

**Error:**
```
expect(hasFocusAfter).toBe(true);
Expected: true
Received: false
```

## Root Cause

The test calls `editor.focus()` and then checks if the editor has focus using `page.evaluate()` to check `document.activeElement`. The focus is not being set correctly.

**Potential causes:**
- Focus needs to target the `.ql-editor` element inside shadow DOM, not the host element
- Timing issue - focus event might not have propagated yet
- Browser security/focus restrictions in test environment

## Investigation Steps

1. Check what `focus()` method does in `EnhancedRichTextEditor.java`
2. Check if RTE 2 base class has a `focus()` method
3. Verify focus target - should be `.ql-editor` or `this._editor.root`
4. Check if focus needs to be triggered on Quill instance (`this._editor.focus()`)
5. Test manually in browser to confirm the method works outside of Playwright

## Acceptance Criteria

- [ ] `focus()` method reliably gives focus to the editor
- [ ] Test `features.spec.ts:716` passes
- [ ] Focus is visible (cursor appears in editor)
- [ ] Subsequent keyboard input goes to the editor

## Notes

- This is a pre-existing bug, not introduced by any Phase 3 work
- Test has been failing since early migration phases
- Low priority - focus() method is rarely used in typical applications
- Most focus operations happen via user clicks, not programmatic API calls

## Implementation Summary

**Root Cause Confirmed:**
The issue exists in **both Stock RTE 2 and ERTE**. Stock RTE 2 does not override the HTMLElement `focus()` method, so calling `element.focus()` only focuses the web component element but does NOT delegate to Quill's internal focus mechanism (`quill.setSelection()` or `quill.focus()`).

**Investigation Results:**
- Stock RTE (http://localhost:8080/): `focus()` call → Quill does NOT receive focus ❌
- ERTE (http://localhost:8080/erte-test/features): `focus()` call → Quill does NOT receive focus ❌
- Both editors: `quill.setSelection(0, 0, 'user')` → Quill receives focus correctly ✅

**Solution:**
Override `focus()` method in ERTE JS to delegate to Quill:

```javascript
focus() {
  if (this._editor) {
    this._editor.focus();
  } else {
    super.focus();
  }
}
```

**Files Modified:**
- `vcf-enhanced-rich-text-editor.js`: +13 lines @ line 792 (after ready() method)

**Test Results:**
- Test #25 (focus() method): ✅ PASS (was failing before)
- Full features.spec.ts suite: **36/36 pass** (no regressions)

**Benefits:**
- Fixes ERTE's focus() API to work as expected
- Makes ERTE's behavior better than Stock RTE 2
- Proper focus delegation to Quill's internal mechanism
- Cursor becomes visible, keyboard input works after focus() call
