# Phase 5.3 Round 2: Multi-Agent Review Findings

**Date:** 2026-02-26
**Agents:** docs-engineer, code-reviewer, security-reviewer, architecture-guard, requirements-reviewer, ui-designer

---

## CRITICAL (must fix before release)

### C1: RteExtensionBase does not exist
**Source:** architecture-guard, code-reviewer, security-reviewer
**Files:** ARCHITECTURE.md, EXTENDING.md, CONTRIBUTING.md, API_REFERENCE.md

Docs describe a two-package bridge pattern with `RteExtensionBase` in `com.vaadin.flow.component.richtexteditor`. This class does not exist. `EnhancedRichTextEditor extends RichTextEditor` directly. All references to RteExtensionBase, the bridge pattern, and the foreign package must be removed/rewritten.

Affected sections:
- ARCHITECTURE.md: lines 21, 151-176, 238, 325
- CONTRIBUTING.md: lines 224, 239-252
- EXTENDING.md: lines 29, 36, 423
- API_REFERENCE.md: line 41-44

### C2: erteSanitize() is static — not overridable
**Source:** security-reviewer
**Files:** API_REFERENCE.md §16

Docs say "extend RteExtensionBase and override erteSanitize()". But:
1. RteExtensionBase doesn't exist (see C1)
2. `erteSanitize()` is `protected static` in EnhancedRichTextEditor — static methods can't be overridden
3. Callers use static dispatch, so a subclass hiding it would have no effect

Fix: Remove override guidance. Document `addAllowedHtmlClasses()` as the only supported customization.

### C3: 2 CSS custom properties undocumented (22, not 20)
**Source:** ui-designer, requirements-reviewer
**Files:** API_REFERENCE.md §15, USER_GUIDE.md §2.10, ARCHITECTURE.md

Missing from docs:
- `--vaadin-erte-ruler-vertical-width` (default: `0.9375rem`)
- `--vaadin-erte-ruler-vertical-background` (default: base64 PNG data URI)

All references to "20 custom properties" must become "22".

### C4: Sanitizer allowed tags list incomplete — 13 tags missing
**Source:** security-reviewer
**Files:** API_REFERENCE.md §16, USER_GUIDE.md §3.4

Documented: 19 tags. Actual (from `Safelist.basic()` + `addTags()`): 32 tags.
Missing: `b`, `cite`, `code`, `dd`, `dl`, `dt`, `i`, `q`, `small`, `strike`, `table`, `tbody`, `tr`, `td`, `th`, `colgroup`, `col`

Table tags are particularly important to document since users auditing the sanitizer need to know tables pass through.

### C5: README project structure shows V24 modules
**Source:** docs-engineer
**Files:** README.md (lines 122-129)

Project structure table lists `enhanced-rich-text-editor/` (V24 module) instead of current modules. Misleading for new developers.

---

## IMPORTANT (should fix)

### I1: setPlaceholders() signature wrong — List vs Collection
**Source:** code-reviewer
**Files:** API_REFERENCE.md §1 (line 315)

Documented: `setPlaceholders(List<Placeholder>)`. Actual: `setPlaceholders(Collection<Placeholder>)`.

### I2: UPGRADE_GUIDE claims constructors removed — they still exist
**Source:** code-reviewer
**Files:** UPGRADE_GUIDE.md (lines 409-411)

Claims `Constructor(String)`, `Constructor(String, ValueChangeListener)`, `Constructor(ValueChangeListener)` are removed. They still exist in EnhancedRichTextEditor.java (lines 107, 119, 135).

### I3: CONTRIBUTING test view table incomplete (5 of 14)
**Source:** architecture-guard
**Files:** CONTRIBUTING.md (lines 306-313)

Missing: ErteShellTestView, ErteExtendOptionsTestView, ErteReplaceIconTestView, ErteTablesTestView, ErteToolbarDialogTestView, ErteToolbarPopoverTestView, ErteToolbarSelectPopupTestView, plus ErteTestLayout and ItApplication.

### I4: CONTRIBUTING placeholder route wrong
**Source:** architecture-guard
**Files:** CONTRIBUTING.md (line 311)

Documented: `/erte-test/placeholder`. Actual: `/erte-test/placeholders` (with trailing "s").

### I5: Sanitizer attributes incomplete
**Source:** security-reviewer
**Files:** API_REFERENCE.md §16

- `a[target]` documented as allowed but NOT in implementation (will be stripped)
- Table element attributes missing: `td[table_id, row_id, cell_id, merge_id, colspan, rowspan, table-class]`, `tr[row_id]`, `table[table_id]`
- `blockquote[cite]` and `q[cite]` from `Safelist.basic()` undocumented

### I6: SECURITY.md outdated — no fixed/open status
**Source:** security-reviewer
**Files:** SECURITY.md

No indication which V24 findings are fixed vs open in V25. PlaceholderBlot XSS = fixed. CSS injection in table colors = NOT fixed. Unrestricted style = fixed. data: protocol = fixed.

### I7: CSS injection in table color APIs not fixed
**Source:** security-reviewer
**Files:** EnhancedRichTextEditorTables.java (lines 444-465)

`setTableHoverColor()`, `setCellHoverColor()` etc. concatenate colors directly into CSS without validation. `TemplateJsonConstants.isValidColor()` exists but isn't used. Not a doc issue per se, but docs should warn about untrusted input, or code should validate.

### I8: ARCHITECTURE files table — stale line counts, missing files
**Source:** architecture-guard
**Files:** ARCHITECTURE.md (lines 322-335)

- RteExtensionBase.java listed (297 lines) — doesn't exist
- EnhancedRichTextEditor.java: 1324 documented, 1799 actual
- vcf-enhanced-rich-text-editor.js: 2635 documented, 2651 actual
- Missing: SlotUtil.java, TabConverter.java

### I9: addAllowedHtmlClasses() / removeAllowedHtmlClasses() undocumented
**Source:** requirements-reviewer
**Files:** API_REFERENCE.md

Public API methods not in API Reference. Used by Tables addon to register dynamic CSS classes. Also missing: `getPlaceholderAltAppearancePattern()` getter.

### I10: Shadow parts incomplete in docs
**Source:** ui-designer
**Files:** API_REFERENCE.md §13

Missing:
- `toolbar-group-custom` (the most common slot target)
- `toolbar-button-align-justify-icon`
- 5 ruler parts: `ruler-wrapper`, `ruler-corner`, `horizontalRuler`, `content-wrapper`, `verticalRuler`

### I11: EXTENDING.md sanitizer location wrong
**Source:** ui-designer, architecture-guard
**Files:** EXTENDING.md (lines 29, 36, 423)

Says `ALLOWED_ERTE_CLASSES` and `erteSanitize()` are in `RteExtensionBase.java`. Actually in `EnhancedRichTextEditor.java` (lines 161, 223). Subsumed by C1 fix.

### I12: Test counts stale — docs say 306, actual ~298
**Source:** architecture-guard

Spec file counts: shell(6) + extend(4) + features(36) + placeholders(30) + readonly(17) + replace-icons(10) + tables(82) + tabstops(81) + toolbar(32) = 298. Docs/CLAUDE.md say 306.

### I13: DEVELOPER_GUIDE module table shows post-release names
**Source:** architecture-guard
**Files:** DEVELOPER_GUIDE.md (lines 48-51)

Shows `enhanced-rich-text-editor/` and `enhanced-rich-text-editor-tables/` (target names without -v25). But these are dev docs — during development the actual directory names have -v25 suffix. Could be intentional (docs written for post-release) or confusing.

Note: This was intentionally applied in Round 1a (global rule 2). Dev docs should probably keep current directory names until release. User docs use post-release names.

---

## MINOR (nice-to-have)

### M1: Whitespace property defaults omit fallback values
**Source:** ui-designer
Documented: `var(--lumo-contrast-40pct)`. Actual: `var(--lumo-contrast-40pct, rgba(0, 0, 0, 0.38))`.

### M2: ql-indent-* accepts any suffix, not just 1-8
**Source:** security-reviewer
Implementation uses `startsWith("ql-indent")`, so `ql-indent-99` is accepted.

### M3: image/jpg MIME type missing from docs
**Source:** security-reviewer
Implementation allows `image/jpg` in addition to `image/jpeg`.

### M4: ARCHITECTURE lumoInjector code slightly different
**Source:** architecture-guard
Documented: `return { is: 'vaadin-rich-text-editor' }`. Actual: `return { ...super.lumoInjector, is: 'vaadin-rich-text-editor' }`.

### M5: Arrow Navigation minimal documentation
**Source:** requirements-reviewer
Only 1 sentence in USER_GUIDE §2.3, no CHANGELOG entry. No Java API (client-side only), so partially justified.

### M6: .ql-tab-guard CSS class undocumented
**Source:** ui-designer
Created dynamically by TabBlot._wrapGuardNodes(), styled in CSS. Relevant for custom embed developers.

### M7: ARCHITECTURE ToolbarButton/Event line references wrong
**Source:** architecture-guard
Documented: "ToolbarButton enum (lines 222-258)" → actual: lines 679-724. "Event classes (lines 485+)" → actual: line 1226+.

### M8: ARCHITECTURE demo view reference wrong
**Source:** architecture-guard
References "V25DemoView" — doesn't exist. Actual views: ErteSamplesView, ErtePlaygroundView, etc.

### M9: ERTE_PRESERVED_CLASSES array incomplete in ARCHITECTURE
**Source:** architecture-guard
Docs list 5 classes. JS has 6 (adds `ql-editor__table--hideBorder`). Java has 7 (adds `td-q`).

### M10: Slotted component CSS states — 4 additional states undocumented
**Source:** ui-designer
Missing: `:active` press feedback, `:host([disabled])` reset, `@media (hover: none)` reset, `vaadin-button` min-width.
