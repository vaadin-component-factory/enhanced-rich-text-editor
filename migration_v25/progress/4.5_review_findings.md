# Phase 4.5 Review Findings

**Reviewers:** code-reviewer + docs-engineer
**Date:** 2026-02-25
**Status:** ALL FIXED (build green)

---

## CRITICAL

### 1. Template ID Regex in TableSelectedEvent (Code Bug)

**File:** `enhanced-rich-text-editor-tables/src/main/java/.../events/TableSelectedEvent.java:44`

**Problem:** Uses `[A-Za-z0-9\\-]+` — allows IDs starting with numbers/hyphens.
**Expected:** `[A-Za-z][A-Za-z0-9\\-]*` (matching `TemplateJsonConstants.PATTERN_TEMPLATE_ID`).

**Note:** The `EnhancedRichTextEditorTables` class itself already uses `TemplateParser.isValidTemplateId()` (which uses the correct pattern). Only `TableSelectedEvent` constructor has a hardcoded wrong regex. Best fix: replace inline regex with `TemplateParser.isValidTemplateId()` call.

---

## HIGH

### 2. Wrong Method Name in TABLES_GUIDE.md

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_GUIDE.md`
**Lines:** L599, L725 (API reference tables)

**Problem:** Says `getAddTablePopover()` — actual method is `getAddTablePopup()`.
**Note:** Variable names in code examples (L89, L582) use correct name. Only the reference tables are wrong.

### 3. Missing @throws on Methods That Throw IllegalArgumentException

**File:** `enhanced-rich-text-editor-tables/src/main/java/.../EnhancedRichTextEditorTables.java`

Methods missing `@throws IllegalArgumentException` in JavaDoc:
- `insertTableAtCurrentPosition(int, int, String)` (L489-495) — throws at L498-501
- `setTableHoverColor(String)` (L764-767) — throws at L769-770
- `setTableCellHoverColor(String)` (L776-779) — throws at L782-783
- `setTableCellFocusColor(String)` (L789-792) — throws at L795-796
- `setTableFocusColor(String)` (L802-805) — throws at L808-809
- `setTemplateIdForCurrentTable(String)` (L507-510) — indirect via TemplateSelectedEvent

### 4. Missing Import in TABLES_UPGRADE_GUIDE.md

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_UPGRADE_GUIDE.md:176`

**Problem:** Step 3 example uses `JsonNode` (L194) but only shows `ObjectNode` import (L176).
**Fix:** Add `import tools.jackson.databind.JsonNode;` after the ObjectNode import.

### 5. Missing Method in API Quick Reference

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_GUIDE.md` (Section 10, ~L706-729)

**Problem:** `setTemplateIdForCurrentTable(templateId)` not listed in the API reference table.
It IS documented in Section 4 (L160-161) but skipped in the reference.

### 6. Event Listeners Return Registration — Not Documented

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_GUIDE.md` (Section 5, ~L322-441)

**Problem:** All `add*Listener()` methods return `Registration` for unregistering, but no example shows this pattern. Add one example:
```java
Registration reg = tables.addTableSelectedListener(e -> { ... });
// Later: reg.remove();
```

---

## MEDIUM

### 7. Grammar in JavaDoc

**File:** `enhanced-rich-text-editor-tables/src/main/java/.../EnhancedRichTextEditorTables.java:804`

**Problem:** "a the table border color" → "the table border color"

### 8. "Underscores OK" Claim Contradicts Regex

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_UPGRADE_GUIDE.md:129`

**Problem:** Says `template_2 (underscores OK in practice)` — but `PATTERN_TEMPLATE_ID` is `[A-Za-z][A-Za-z0-9\\-]*` which does NOT include underscores.
**Fix:** Remove the underscore example and claim.

### 9. Color Validation Formats Missing in TABLES_GUIDE

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_GUIDE.md:506`

**Problem:** L506 says "Invalid colors throw IllegalArgumentException" but doesn't list accepted formats.
**Fix:** Add accepted formats (already listed in UPGRADE_GUIDE L108): hex, named, rgb/rgba, hsl/hsla, CSS variables.

### 10. IllegalArgumentException Warning Missing at Color Setters in Guide

**File:** `enhanced-rich-text-editor-tables/docs/TABLES_GUIDE.md` (Section 6, ~L489-504)

**Problem:** Code examples for `setTableHoverColor()` etc. don't mention that invalid colors throw.
**Note:** L506 does mention it briefly, but the code examples should have a note. Already partially addressed by issue #9.

---

## LOW

### 11. Missing Class-Level JavaDocs on 4 Event Classes

**Files:**
- `.../templates/events/TemplateCreatedEvent.java` — no class JavaDoc
- `.../templates/events/TemplateUpdatedEvent.java` — no class JavaDoc
- `.../templates/events/TemplateDeletedEvent.java` — no class JavaDoc
- `.../templates/events/TemplatesInitializedEvent.java` — no class JavaDoc

All extend documented parents, so impact is low.

### 12. README Absolute Path to CONTRIBUTING.md

**File:** `enhanced-rich-text-editor-tables/README.md:65`

**Problem:** Uses `/workspace/docs/CONTRIBUTING.md` (absolute workspace path).
**Fix:** Use relative `../docs/CONTRIBUTING.md`.
