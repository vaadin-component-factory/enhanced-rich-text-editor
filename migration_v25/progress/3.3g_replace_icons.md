# Phase 3.3g: Replace Toolbar Button Icons (Feature 19)

## Status: COMPLETE

**Completed:** 2026-02-20

## Feature Summary
`replaceStandardToolbarButtonIcon(ToolbarButton, Icon)` replaces icon in a toolbar button's slot using a type-safe enum API.

## Dependencies
- Phase 3.1a (Custom Slots) — slot-based icon replacement infrastructure
- Phase 3.3f (Align Justify) — validated icon slot pattern

## Implementation Details

### Java API

**File:** `EnhancedRichTextEditor.java` (lines 136-161)

**Method signature:**
```java
public void replaceStandardToolbarButtonIcon(ToolbarButton button, Icon icon)
```

**Key design decisions:**
- Uses `button.getPartSuffix()` to get slot name (e.g., "bold", "align-justify")
- Delegates to existing `replaceStandardButtonIcon(Icon, String)` method
- Accepts `null` icon to clear slot and restore default (improvement over V24)
- Throws `NullPointerException` if button is null (documented)

**Example usage:**
```java
editor.replaceStandardToolbarButtonIcon(
    ToolbarButton.BOLD,
    new Icon(VaadinIcon.STAR)
);
```

### Test View

**File:** `ErteReplaceIconTestView.java`

**Pre-configured icons (for automated testing):**
- Bold → Star
- Italic → Flag
- Undo → Arrow Left
- Redo → Arrow Right
- Align Left → Airplane

**Control buttons:**
- "Clear Bold Icon" — tests null icon (restore default)
- "Replace Align Center" — tests runtime replacement
- "Set German I18n" — tests icon survival after toolbar re-render

### Playwright Tests

**File:** `tests/erte/replace-icons.spec.ts`

**Test coverage (10 tests, all passing):**
1. Pre-configured icons render on load
2. Default icons are removed when custom icon present
3. Custom icon has correct attributes
4. Null icon clears slot and restores default
5. Runtime icon replacement works
6. Icons survive toolbar re-render (i18n change)
7. Multiple icon replacements coexist
8. Icon replacement does not affect button functionality
9. ERTE-specific button icon replacement (justify)
10. Enum API provides compile-time safety

### Navigation Update

**File:** `ErteTestLayout.java` (lines 109-111)

Changed from `disabled("3.3g Replace Icons", ...)` to:
```java
new SideNavItem("3.3g Replace Icons",
    "erte-test/replace-icons",
    VaadinIcon.PICTURE.create())
```

## Breaking Changes

**None.** This adds a new overload alongside the existing string-based API.

**Improvement over V24:** Null icon now clears slot instead of throwing NPE.

## Edge Cases Handled

- **Null icon:** Clears slot, restores default (test 4)
- **Null button:** Throws `NullPointerException` with clear message (documented)
- **Multiple replacements:** All coexist independently (test 7)
- **Toolbar re-render:** Icons survive i18n changes (test 6)
- **Runtime replacement:** Works after page load (test 5)
- **ERTE buttons:** Works with custom buttons like ALIGN_JUSTIFY (test 9)

## Test Results

**All 10 tests PASS** ✅

```
Running 10 tests using 1 worker
  ✓   1 Pre-configured icons render on load (1.0s)
  ✓   2 Default icons are removed when custom icon present (607ms)
  ✓   3 Custom icon has correct attributes (583ms)
  ✓   4 Null icon clears slot and restores default (1.0s)
  ✓   5 Runtime icon replacement works (726ms)
  ✓   6 Icons survive toolbar re-render (i18n change) (761ms)
  ✓   7 Multiple icon replacements coexist (600ms)
  ✓   8 Icon replacement does not affect button functionality (901ms)
  ✓   9 ERTE-specific button icon replacement (justify) (951ms)
  ✓  10 Enum API provides compile-time safety (598ms)

  10 passed (8.7s)
```

**Baseline after Phase 3.3g:** 205 tests total (75 prototype + 130 ERTE core)
- Expected: 196 passing, 11 fixme (185 previous + 10 new + 1 from align-justify fix)

## Acceptance Criteria
- [x] `replaceStandardToolbarButtonIcon()` Java API
- [x] Icon replacement via Vaadin Icon component in named slots
- [x] Playwright tests
