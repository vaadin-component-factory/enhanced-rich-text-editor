# Phase 3.4k: Custom Properties for ERTE Styles

**Status:** COMPLETE
**Type:** Theming API Enhancement
**Priority:** MEDIUM — Improves user customization

## Objective

Create dedicated CSS custom properties (with `--vaadin-erte-*` prefix) for all ERTE-specific styles. This follows Vaadin component conventions and allows users to style ERTE features independently from other Vaadin components.

## Implementation Summary

20 custom properties defined in a dedicated CSS stylesheet (`styles/vcf-enhanced-rich-text-editor-styles.css`), imported via Vite's `?inline` CSS import. Ruler styling moved from inline JS `style.cssText` to CSS rules with `[part]` selectors. Tabstop marker centering improved with `translateX(-50%)`.

**Post-review changes:** Reduced from 21 to 15 properties after review. Removed 6 toolbar-related properties (`placeholder-button-font-size` + 5 `toolbar-custom-component-*`). Rationale: toolbar custom components should inherit from RTE 2's `--vaadin-rich-text-editor-toolbar-button-*` properties, not have separate ERTE properties. Custom properties focus on editor-content features (readonly, placeholder, whitespace, ruler). Fixed ruler border fallback with three-level chain (`--vaadin-border-color` → `--lumo-contrast-20pct` → `rgb(158,170,182)`).

**Design token refinement:** Expanded from 15 to 20 properties. Replaced static `px`/`em` defaults with `--vaadin-*` design tokens (`calc(var(--vaadin-padding-xs) / 2)` for small paddings/spacings, `0.9375rem` for ruler dimensions). Added 3 missing placeholder properties (color, border-color, border-width) for parity with readonly. Added 2 ruler properties (background, marker-color) for full customizability.

### Changes Made

1. Extracted ALL ERTE CSS from JS into separate stylesheet `styles/vcf-enhanced-rich-text-editor-styles.css`
2. JS imports CSS via `import erteStyles from './styles/...css?inline'` + `unsafeCSS(erteStyles)`
3. Removed `RULER_HORI_BASE64` JS constant (base64 image now directly in CSS `url()`)
4. Removed `css` import from `lit` (only `unsafeCSS` needed)
5. Defined `:host` block with 20 custom property definitions
6. Updated `.ql-readonly` to use `--vaadin-erte-readonly-*` properties (outline split into longhand for `var()` support)
7. Updated `.ql-placeholder` to use `--vaadin-erte-placeholder-*` properties
8. Updated whitespace indicator CSS to use `--vaadin-erte-whitespace-*` properties
9. Updated toolbar custom component CSS to inherit from RTE 2's `--vaadin-rich-text-editor-toolbar-button-*` properties
10. Added ruler CSS rules using `[part]` selectors (replaces inline styles)
11. Simplified `_injectRuler()` — removed all `style.cssText` lines
12. Simplified `_addTabStopIcon()` — removed width/height/position/top (now in CSS), improved centering with `translateX(-50%)`
10. Fixed `_onNoRulersChanged()` — `''` instead of `'flex'` to let CSS rule take effect

### Test Results

- **214 passed, 0 failed, 10 skipped**
- Screenshot snapshot updated for toolbar custom components (border box model change: +2px from transparent border matching RTE native buttons)
- All features visually identical to pre-change state

## Custom Properties List (20 properties)

### Readonly Sections (6)

#### --vaadin-erte-readonly-color
**Description:** Text color for readonly sections
**Default:** `var(--vaadin-text-color-secondary)`
**Affects:** `.ql-readonly` text color

#### --vaadin-erte-readonly-background
**Description:** Background color for readonly sections
**Default:** `var(--vaadin-background-container)`
**Affects:** `.ql-readonly` background

#### --vaadin-erte-readonly-border-color
**Description:** Outline color for readonly sections
**Default:** `var(--vaadin-border-color-secondary)`
**Affects:** `.ql-readonly` outline color

#### --vaadin-erte-readonly-border-width
**Description:** Outline width for readonly sections
**Default:** `1px`
**Affects:** `.ql-readonly` outline width and offset

#### --vaadin-erte-readonly-border-radius
**Description:** Corner radius for readonly sections
**Default:** `var(--lumo-border-radius-s)`
**Affects:** `.ql-readonly` border-radius

#### --vaadin-erte-readonly-padding
**Description:** Horizontal padding for readonly sections
**Default:** `calc(var(--vaadin-padding-xs) / 2)`
**Affects:** `.ql-readonly` padding-inline

### Placeholders (6)

#### --vaadin-erte-placeholder-color
**Description:** Text color for placeholder tokens
**Default:** `inherit`
**Affects:** `.ql-placeholder` text color

#### --vaadin-erte-placeholder-background
**Description:** Background color for placeholder tokens
**Default:** `var(--lumo-primary-color-10pct)`
**Affects:** `.ql-placeholder` background

#### --vaadin-erte-placeholder-border-color
**Description:** Outline color for placeholder tokens
**Default:** `transparent`
**Affects:** `.ql-placeholder` outline color

#### --vaadin-erte-placeholder-border-width
**Description:** Outline width for placeholder tokens
**Default:** `0`
**Affects:** `.ql-placeholder` outline width and offset

#### --vaadin-erte-placeholder-border-radius
**Description:** Corner radius for placeholder tokens
**Default:** `var(--lumo-border-radius-s)`
**Affects:** `.ql-placeholder` border-radius

#### --vaadin-erte-placeholder-padding
**Description:** Horizontal padding for placeholder tokens
**Default:** `calc(var(--vaadin-padding-xs) / 2)`
**Affects:** `.ql-placeholder` padding-inline

### Whitespace Indicators (3)

#### --vaadin-erte-whitespace-indicator-color
**Description:** Color for tab (→), soft-break (↵), and NBSP (·) indicators
**Default:** `var(--lumo-contrast-40pct, rgba(0, 0, 0, 0.38))`
**Affects:** Tab, soft-break, NBSP indicator pseudo-elements

#### --vaadin-erte-whitespace-paragraph-indicator-color
**Description:** Color for paragraph/pilcrow (¶) indicator (lighter than other indicators)
**Default:** `var(--lumo-contrast-30pct, rgba(0, 0, 0, 0.26))`
**Affects:** Paragraph indicator pseudo-elements

#### --vaadin-erte-whitespace-indicator-spacing
**Description:** Spacing/offset for indicator symbols (right offset for tab arrow, left margin for pilcrow, right margin for NBSP dot)
**Default:** `calc(var(--vaadin-padding-xs) / 2)`
**Affects:** Tab `right`, paragraph `margin-left`, NBSP `margin-right`

### Ruler (5)

#### --vaadin-erte-ruler-height
**Description:** Height of the ruler widget
**Default:** `0.9375rem`
**Affects:** `[part~="ruler-wrapper"]` height, `[part~="horizontalRuler"]` height, `[part~="ruler-corner"]` width/height

#### --vaadin-erte-ruler-border-color
**Description:** Border color for the ruler corner
**Default:** `var(--vaadin-border-color, var(--lumo-contrast-20pct, rgb(158, 170, 182)))`
**Affects:** `[part~="ruler-corner"]` border-color

#### --vaadin-erte-ruler-background
**Description:** Background image for the ruler tick marks
**Default:** `url('data:image/png;base64,...') repeat-x`
**Affects:** `[part~="horizontalRuler"]` background

#### --vaadin-erte-ruler-marker-size
**Description:** Size of tabstop marker icons on the ruler
**Default:** `0.9375rem`
**Affects:** `[part~="horizontalRuler"] > vaadin-icon` width/height

#### --vaadin-erte-ruler-marker-color
**Description:** Color of tabstop marker icons on the ruler
**Default:** `inherit`
**Affects:** `[part~="horizontalRuler"] > vaadin-icon` color

### Toolbar Custom Components (REMOVED — inherits from RTE 2)

Custom toolbar components added via `addToolbarComponents()` now inherit styling from RTE 2's `--vaadin-rich-text-editor-toolbar-button-*` properties. This ensures custom components match built-in toolbar buttons when users customize the RTE toolbar appearance. No separate ERTE custom properties needed.

## Usage Examples

### Global Override
```css
vcf-enhanced-rich-text-editor {
  --vaadin-erte-readonly-background: lightyellow;
  --vaadin-erte-readonly-border-color: orange;
  --vaadin-erte-placeholder-background: lightblue;
}
```

### Instance Override (Java)
```java
editor.getStyle().set("--vaadin-erte-readonly-background", "lightyellow");
```

### Dark Mode
Cross-theme tokens (`--vaadin-text-color-secondary`, `--vaadin-background-container`, `--vaadin-border-color-secondary`, `--vaadin-border-color`) auto-adapt to dark mode. Lumo tokens (`--lumo-*`) also auto-adapt in Lumo theme. No additional overrides needed for dark mode.

### Theme-Specific (Phase 5)
```css
:host([theme~="aura"]) {
  --vaadin-erte-readonly-border-radius: 4px;
  --vaadin-erte-placeholder-background: var(--aura-primary-color-10pct);
}
```

## Explicit Exclusions (NOT getting custom properties)

### Tab Blot (`.ql-tab`, `.ql-tab-guard`) — All Structural
All tab blot values are structural/mechanical with no `--vaadin-*` or `--lumo-*` references:
- `display: inline-block` — MUST be inline-block for Chrome ArrowUp/Down
- `min-width: 2px` — Chrome caret rendering minimum
- `position: relative` — required for guard nodes
- `overflow: visible` — caret taller than tab box
- Guard node styles — internal cursor mechanism

### Other Exclusions
- Whitespace indicator font sizes (`--lumo-font-size-s/m`) — already scale with Lumo
- Whitespace indicator `content` characters — semantic, not theming
- Toolbar component height/padding/border-radius — match Vaadin sizing system
- Soft-break `display: inline` — structural
- SVG icon dimensions — standard sizes

## Success Criteria

- [x] All ERTE editor-content styles use `--vaadin-erte-*` custom properties (20 properties)
- [x] Toolbar custom components inherit from RTE 2's `--vaadin-rich-text-editor-toolbar-button-*`
- [x] Default visual appearance is unchanged (properties default to current values)
- [x] Users can override ERTE styles independently from other Vaadin components
- [x] This progress file contains complete, documented list of all custom properties
- [x] Ruler styling moved from inline JS to CSS with `[part]` selectors
- [x] All 214 tests pass (0 failures)

## Cross-Theme Token Strategy

Where Vaadin provides cross-theme tokens, ERTE defaults use them:
- `--vaadin-text-color-secondary` (replaces `--lumo-secondary-text-color`)
- `--vaadin-background-container` (replaces `--lumo-contrast-5pct`)
- `--vaadin-border-color-secondary` (replaces `--lumo-contrast-10pct`)
- `--vaadin-border-color` (replaces hardcoded `rgb(158,170,182)`)

Where no cross-theme equivalent exists, `--lumo-*` tokens are used. Phase 5 will override `--vaadin-erte-*` directly for Aura theme.

## Notes

- **Theme scope:** ERTE 6.0.0 supports Lumo theme only.
- **Future multi-theme support (Phase 5.1):** Properties designed for Aura override via `:host([theme~="aura"])` selectors.
- **Backward compatibility:** All custom properties default to pre-existing values. Zero visual change.

## Related Files

- `enhanced-rich-text-editor-v25/src/main/resources/META-INF/resources/frontend/styles/vcf-enhanced-rich-text-editor-styles.css` — ERTE stylesheet (custom properties + all CSS rules)
- `enhanced-rich-text-editor-v25/src/main/resources/META-INF/resources/frontend/vcf-enhanced-rich-text-editor.js` — JS component (imports CSS, simplified ruler/icon methods)
