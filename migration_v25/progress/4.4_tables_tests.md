# Phase 4.4: Tables Tests

**Status:** NOT STARTED

## Objective

Create comprehensive Playwright test suite for Tables addon, covering blot behavior, UI controls, Java API, and edge cases.

## Scope

### Test Categories

1. **Table Creation**
   - Insert table via UI/API
   - Initial structure verification
   - Cell metadata verification
   - Delta format correctness

2. **Row Operations**
   - Add row above/below
   - Delete row
   - Row ID preservation
   - Content preservation

3. **Column Operations**
   - Add column left/right
   - Delete column
   - Column ID preservation
   - Content redistribution

4. **Cell Operations**
   - Merge cells (rowspan/colspan)
   - Split cells
   - Cell selection
   - Cell editing

5. **Cell Metadata**
   - Metadata encoding/decoding
   - HTML→Delta→HTML roundtrip
   - Sanitizer preservation
   - Copy-paste survival

6. **UI Controls**
   - Control visibility
   - Control positioning
   - Hover states
   - Click handling

7. **Integration**
   - Tables + Readonly sections
   - Tables + Placeholders
   - Tables + Tabstops
   - Value format (HTML vs Delta)

8. **Edge Cases**
   - Empty table
   - Single cell table
   - Nested content (lists, formats in cells)
   - Large tables (performance)
   - Delete protection

### Test View

- `ErteTablesTestView.java` — comprehensive test interface
- Table operations UI
- Metadata inspection
- Delta/HTML output
- Event log

## Success Criteria

- [ ] Minimum 50 tests covering core functionality
- [ ] All blot operations tested
- [ ] UI controls verified
- [ ] Edge cases covered
- [ ] Integration with ERTE core tested
- [ ] No test failures
- [ ] Reviewed by qa-tester agent

## Test Patterns

**Metadata Verification:**
```typescript
const delta = await getDelta(page);
const tableOp = delta.ops.find(op => op.insert?.td);
expect(tableOp.insert.td).toMatch(/^[\w-]+\|[\w-]+\|[\w-]+\|1\|1\|/);
```

**Cell Selection:**
```typescript
await editor.locator('.ql-editor td').first().click();
// Verify selection state
```

**Control Interaction:**
```typescript
await editor.locator('[part~="add-row-above"]').click();
// Verify new row inserted
```

## Resources

- V24 table tests (if exist)
- ERTE core test patterns (`tests/erte/helpers.ts`)
- Playwright docs for table testing
- Test inventory structure

## Output

- `tests/erte/tables.spec.ts` — main table test suite
- Helper functions in `tests/erte/helpers.ts` (if needed)
- `ErteTablesTestView.java` — test view
- Test documentation in `TEST_INVENTORY.md`
