# Phase 3.4h: ToolbarSelectPopup

**Status:** NOT STARTED
**Type:** Feature Migration
**Priority:** MEDIUM — Helper class for custom toolbar extensions
**Created:** 2026-02-21

---

## Scope

Migrate `ToolbarSelectPopup` class from V24 to V25. This is a convenience wrapper around Vaadin's `ContextMenu` component that integrates with `ToolbarSwitch` for opening/closing.

---

## Background

### V24 Implementation

Location: `enhanced-rich-text-editor/src/main/java/com/vaadin/componentfactory/toolbar/ToolbarSelectPopup.java`

**Key Features:**
- Wraps Vaadin 24's `ContextMenu` component
- Opens/closes based on `ToolbarSwitch` active state
- Sets `openOnClick(true)`
- Syncs switch active state with context menu open state

**API:**
```java
// Constructor
ToolbarSelectPopup(ToolbarSwitch referencedSwitch)
```

**Usage Pattern:**
```java
ToolbarSwitch formatSwitch = new ToolbarSwitch();
ToolbarSelectPopup popup = new ToolbarSelectPopup(formatSwitch);
popup.addItem("Option 1", e -> { /* ... */ });
popup.addItem("Option 2", e -> { /* ... */ });
```

### V25 Changes

**Vaadin 25 ContextMenu API:**
- Verify `ContextMenu` API unchanged between V24 and V25
- Confirm `setOpenOnClick()`, `addOpenedChangeListener()` still exist
- Check if constructor signature changed

---

## Tasks

### 1. Create ToolbarSelectPopup.java (V25)

Location: `enhanced-rich-text-editor-v25/src/main/java/com/vaadin/componentfactory/toolbar/ToolbarSelectPopup.java`

- [ ] Copy V24 implementation as starting point
- [ ] Update license header (2025)
- [ ] Verify Vaadin 25 imports work (`com.vaadin.flow.component.contextmenu.ContextMenu`)
- [ ] Test with simple example

### 2. Add JavaDoc

- [ ] Class-level JavaDoc explaining purpose
- [ ] Document integration with ToolbarSwitch
- [ ] Add usage example in JavaDoc

### 3. Create Test View (Optional)

Only if not already covered by existing demos:

- [ ] Add test view showing context menu with toolbar switch
- [ ] Test item selection
- [ ] Test open/close state sync

### 4. Update Documentation

- [ ] Add to API documentation
- [ ] Add example usage in developer docs
- [ ] Mention in UPGRADE_GUIDE.md if API changed

---

## Testing Strategy

- **Manual:** Create simple demo with ToolbarSwitch + ToolbarSelectPopup, verify menu opens on click
- **Integration:** Verify with actual ERTE instance in demo app
- **Regression:** Compare behavior with V24 implementation

---

## Dependencies

- ✅ Phase 3.1a (Toolbar Slot System) — provides `ToolbarSwitch`
- ⚠️ Phase 3.4f (Slotted Styles) — may be needed for proper button appearance

---

## Definition of Done

- [ ] `ToolbarSelectPopup.java` created with V25-compatible implementation
- [ ] JavaDoc complete
- [ ] Manual testing shows context menu works correctly
- [ ] Open/close state syncs with switch
- [ ] Progress file updated to COMPLETE
- [ ] Commit created: "Add ToolbarSelectPopup helper class (Phase 3.4h)"
